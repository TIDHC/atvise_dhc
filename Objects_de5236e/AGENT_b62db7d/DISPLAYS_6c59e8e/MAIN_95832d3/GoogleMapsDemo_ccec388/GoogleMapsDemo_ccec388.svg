<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<svg height="680" version="1.2" width="1280" xmlns="http://www.w3.org/2000/svg" xmlns:atv="http://webmi.atvise.com/2007/svgext" xmlns:xlink="http://www.w3.org/1999/xlink">
 <defs/>
 <metadata>
  <atv:gridconfig enabled="false" gridstyle="lines" height="20" width="20"/>
  <atv:snapconfig enabled="false" height="10" width="10"/>
 </metadata>
 <foreignObject height="508.681" id="map_canvas" width="749.787" x="32.94" y="50.453"/>
 <text atv:refpx="194.44" atv:refpy="26.679" fill="#000000" font-family="Arial" font-size="18" id="id_info" x="37.44" y="31.179">Put your mouse over the bulb symbols..</text>
 <svg atv:refpx="988.555" atv:refpy="350.453" height="600" id="id_0" transform="matrix(0.5,0,0,1,0,0)" width="800" x="1577.109" xlink:href="SYSTEM.LIBRARY.ATVISE.OBJECTDISPLAYS.Advanced.hmi.iframe" y="50.453">
  <atv:argument name="frameName" value="building-details"/>
 </svg>
 <text atv:refpx="280.007" atv:refpy="619.087" fill="#000088" font-family="Arial" font-size="12" id="id_1" x="33.007" y="623.587">Put the following line as a script source to the index.htm (->LIBRARY.PROJECT.Resources)</text>
 <text atv:refpx="294.046" atv:refpy="647.877" fill="#000088" font-family="Arial" font-size="12" id="id_2" x="33.046" y="652.377">&lt;script type="text/javascript" src="https://maps.google.com/maps/api/js?sensor=false">&lt;/script></text>
 <text atv:refpx="307.714" atv:refpy="590.947" fill="#000088" font-family="Arial" font-size="12" id="id_3" x="32.836" y="595.447">Copy index.htm (-> LIBRARY.ATVISE.Resources) to the Project folder (-> LIBRARY.ATVISE.Resources) </text>
 <script atv:desc="" atv:name="" type="text/ecmascript"><![CDATA[var google = webMI.rootWindow.google;

var map;

var marker1, marker2;

const symbolLightOn = "/lamp_on.png";
const symbolLightOff = "/lamp_off.png";

webMI.addOnload(function() {
	var position1 = new google.maps.LatLng(47.85193,16.54015);
	var position2 = new google.maps.LatLng(47.85206,16.54041);	
	
	var myOptions = {
		zoom: 19,
		center: position1,
		mapTypeId: google.maps.MapTypeId.SATELLITE
	};
	
	map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);

	marker1 = new google.maps.Marker({
		position: position1,
		map: map,
		title: "Building 1",
		icon: symbolLightOff,
	});
	
	marker2 = new google.maps.Marker({
		position: position2,
		map: map,
		title: "Building 1",
		icon: symbolLightOff
	});

	var infowindow1 = new google.maps.InfoWindow();
	var infowindow2 = new google.maps.InfoWindow();

	google.maps.event.addListenerOnce(map, 'idle', function() {
		google.maps.event.trigger(map, 'resize');
		map.setCenter(position1);
	});

	/*-----functionality for marker 1-------------*/

	//subscribe to a datapoint to change the marker1 symbol:
	webMI.data.subscribe("AGENT.OBJECTS.GoogleMapsDemo.Building_1.LightOn", function(e) {
		if(e.value) {
			marker1.setIcon(symbolLightOn);
		} else {
			marker1.setIcon(symbolLightOff);
		}
	});	
	
	//add a click listener do marke1 to open a detail display:
	marker1.addListener("click", function(e){
		webMI.display.openDisplay("ObjectTypes.PROJECT.Building.BuldingDetails", {base: "AGENT.OBJECTS.GoogleMapsDemo.Building_1"}, "building-details");
	});
	
	//add a mousover event to marker1 to show an info text and open an infowindow:
	marker1.addListener("mouseover", function(e){
		webMI.gfx.setText("id_info", "This is Building 1 - Click bulb for control.")
		infowindow1.open(map, marker1);
	});
	
	//add mousout to hide info text and infowindow:
	marker1.addListener("mouseout", function(e){
		webMI.gfx.setText("id_info", "")
		infowindow1.close();
	});
	
	//add a subscribe to a datapoint to display the current value in the infowindow:
	webMI.data.subscribe("AGENT.OBJECTS.GoogleMapsDemo.Building_1.TempMeasured", function(e){
		infowindow1.setContent("Building 1 - Temperature: " + e.value.toFixed(2) + "°C");
	});
        
	/*-----same functionality for marker 2-------------*/
	
	webMI.data.subscribe("AGENT.OBJECTS.GoogleMapsDemo.Building_2.LightOn", function(e) {
		if(e.value) {
			marker2.setIcon(symbolLightOn);
		} else {
			marker2.setIcon(symbolLightOff);
	}
	});
	
	marker2.addListener("click", function(e){
		webMI.display.openDisplay("ObjectTypes.PROJECT.Building.BuldingDetails", {base: "AGENT.OBJECTS.GoogleMapsDemo.Building_2"}, "building-details");
	});
	
	marker2.addListener("mouseover", function(e){
		webMI.gfx.setText("id_info", "This is Building 2 - Click bulb for control.")
		infowindow2.open(map, marker2);
	});
	
	marker2.addListener("mouseout", function(e){
		webMI.gfx.setText("id_info", "")
		infowindow2.close();
	});
	
	webMI.data.subscribe("AGENT.OBJECTS.GoogleMapsDemo.Building_2.TempMeasured", function(e){
		infowindow2.setContent("Building 2 - Temperature: " + e.value.toFixed(2) + "°C");
	});
	
	/*----------------------------------*/

});]]></script>
</svg>
