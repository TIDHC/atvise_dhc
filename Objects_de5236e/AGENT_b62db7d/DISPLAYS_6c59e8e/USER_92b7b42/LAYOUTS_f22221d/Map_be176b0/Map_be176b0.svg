<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<svg height="890" version="1.2" width="1920" xmlns="http://www.w3.org/2000/svg" xmlns:atv="http://webmi.atvise.com/2007/svgext" xmlns:xlink="http://www.w3.org/1999/xlink">
 <defs/>
 <metadata>
  <atv:gridconfig enabled="false" gridstyle="lines" height="20" width="20"/>
  <atv:snapconfig enabled="false" height="10" width="10"/>
 </metadata>
 <foreignObject height="890" id="mapa" width="1920" x="0" y="0">
  <div style="width:100%;height:100%" xmlns="http://www.w3.org/1999/xhtml"/>
 </foreignObject>
 <script atv:desc="" atv:href="SYSTEM.LIBRARY.PROJECT.DISPLAYSCRIPTS.script_circuitos.circuitArray_Sofrel" atv:name="circuitArray_Sofrel" atv:type="text/ecmascript"/>
 <script atv:desc="" atv:name="" type="text/ecmascript"><![CDATA[//----------------Inicializo variables -------------------//


//Variable interna
var Info_Windowact=false;

var Markers= new Array();


var google = webMI.rootWindow.google; //Clase Principal
var map; //Variable donde va a vivir el mapa
			
var infowindow;

const path_circulo = "M 4 1.5 A 2.5 2.5 90 1 0 4 6.5 A 2.5 2.5 90 0 0 4 1.5 Z";
const path_triangulo = "M 3 0.9383 L 5.3878 5.0625 H 0.6122 L 3 0.9383 Z";


const symbolSofrel =  {
    path: path_triangulo,
    fillColor: "blue",
    fillOpacity: 1,
    strokeWeight: 0,
    rotation: 0,
    scale: 3,
    anchor: new google.maps.Point(0, 0),
  };
const symbolOK =   {
    path: path_triangulo,
    fillColor: "orange",
    fillOpacity: 1,
    strokeWeight: 0,
    rotation: 0,
    scale: 3,
    anchor: new google.maps.Point(0, 0),
  };

   const symbolBlack =  {
    path: path_circulo,
    fillColor: "black",
    fillOpacity: 0.6,
    strokeWeight: 0,
    rotation: 0,
    scale: 3,
    anchor: new google.maps.Point(0, 0),
  };


//----------------Ejecución -------------------//



//Determinación del dispositivo
var infoCliente;
infoCliente = new webMI.getClientInfo();

webMI.addOnload(function() {
	

	//Opciones del mapa
	var myOptions = {
		center: { lat: 21.150393921731048, lng: -86.85901679529576 },
		zoom: 14,
		mapId: 'DEMO_MAP_ID',
		mapTypeId: google.maps.MapTypeId.roadmap,
				  
	};
	

	//Inicializo el mapa
	map = new google.maps.Map(document.getElementById("mapa"), myOptions);

		
	// Instantiate an info window to hold step text.
	const stepDisplay = new google.maps.InfoWindow();
		
	
	//-------Inicializo Marcadores
	
	circuito_s.forEach(([position,title,object,order,type],i) =>{
		
		const marker = new google.maps.marker.AdvancedMarkerElement({
			position, 
			map,
			title: ` ${title}`,
		});
			// (Crea Infowindow)
			infowindow = new google.maps.InfoWindow();
			var susID = null;
		marker.addListener("click", () => {
		  // Código que se ejecutará cuando se haga clic en el marcador
		  			            
            webMI.data.unsubscribe(susID);
               			
			susID = null;			

			
			//Abro marcador
			infowindow.open({
			anchor: marker,
			map,
			shouldFocus: false,
			});
			
			
			if (type == 'LS42' || type == 'LSP'){
				//Defino que objeto va a ser el seleccionado para mostrar su información
				
			susID = webMI.data.subscribe( object +".HValuePresion",
				function(e){
					infowindow.setContent(
						'<div id="content">' +
                            '<p id="firstHeading" class="firstHeading">'+title+'</p>' +
                            '<p>'+'Presión: '+ e.value.toFixed(2) +' kg/cm2</p>' +
                         '</div>');
					}
				);
			} 
			setTimeout(function() {
              infowindow.close();             
                webMI.data.unsubscribe(susID);
            }, 5000);
	
		});
	
		marker.setMap(map);
		//Agrego marcador a lista de marcadores
		Markers.push(marker);
	/*
		//-------Listener de Marcadores
		
		//DOBLECLICK (Fija Carcamo)
		google.maps.event.addListener(marker,'dblclick',function(event) {
			map.panTo(this.getPosition());
			map.setZoom(15);
		
			switch(type) {
			case "LSP":
				webMI.data.subscribe( object +".DataloggerID",
					function(e){
						webMI.display.openWindow({display:"SYSTEM.DISPLAYS.Sectorizacion.Grafico_Sectorizacion_Solo_Presion" ,
						extern:false,height:770,menubar:false,modal:false,movable:true,resizable:true,scrollbars:false,status:false,
						title:e.value,toolbar:false,x:1000, y:0, width:920,query:{base:object}});
						
						}
					);
				break;
			case "LS42":
			webMI.data.subscribe( object +".DataloggerID",
				function(e){					
					webMI.display.openWindow({display:"SYSTEM.DISPLAYS.Sectorizacion.Grafico_Sectorizacion" ,
					extern:false,height:880,menubar:false,modal:false,movable:true,resizable:true,scrollbars:false,status:false,
					title:e.value,toolbar:false,x:200,y:0,width:1600,query:{base:object}});
					}
				);
				break;
			default:
			break;
						}
				

			Markeract=true;
			Markeractdc=marker;
			Pos_origen=position;
		

				
		});

		
		var susID = null;
		//CLICK (Abre Infowindow)
		google.maps.event.addListener(marker,'click',function(event) {	
			            
            webMI.data.unsubscribe(susID);
               			
			susID = null;
			
			
			
			infowindow = new google.maps.InfoWindow();
			//Abro marcador
			infowindow.open(marker.getMap,marker);
			
			
			if (type == 'LS42' || type == 'LSP'){
				//Defino que objeto va a ser el seleccionado para mostrar su información
				
			susID = webMI.data.subscribe( object +".HValuePresion",
				function(e){
					infowindow.setContent(
						'<div id="content">' +
                            '<h2 id="firstHeading" class="firstHeading">'+title+'</h2>' +
                            '<h3>'+'Presión: '+ e.value.toFixed(2) +' kg/cm2</h3>' +
                         '</div>');
					}
				);
			} 
			setTimeout(function() {
              infowindow.close();             
                webMI.data.unsubscribe(susID);
            }, 5000);
		});	
			*/
	
	});	
		
});

]]></script>
</svg>
